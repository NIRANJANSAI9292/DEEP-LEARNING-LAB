# LAB 15
# -------------------------------
# LAB 15: YOLOv8 Object Detection
# -------------------------------

# 1️⃣  Install and import dependencies
!pip install ultralytics -q

from ultralytics import YOLO
import matplotlib.pyplot as plt
import cv2
from google.colab.patches import cv2_imshow  # Use cv2_imshow in Colab

# 2️⃣  Load a pre-trained YOLOv8 model
# (This uses YOLOv8n – small version, fast to load)
model = YOLO('yolov8n.pt')

# 3️⃣  Run object detection on a sample image
# You can change this to your own image path
results = model.predict(source='https://ultralytics.com/images/zidane.jpg', show=True)

# 4️⃣  Show the detected image with bounding boxes
# YOLO automatically saves detections in 'runs/detect/predict'
# We'll reload that image and display it
import glob
img_path = glob.glob('runs/detect/predict/*.jpg')[0]
img = cv2.imread(img_path)
cv2_imshow(img)  # Displays the image in Colab
plt.title("Detected Objects by YOLOv8")
plt.axis('off')
plt.show()

# 5️⃣  Optional: Train on a small dataset (for graph demo)
# Using COCO128 sample dataset
results_train = model.train(data='coco128.yaml', epochs=3)

# 6️⃣  Plot training loss graph
metrics = model.results[-1] if hasattr(model, 'results') else None

# YOLO saves training results automatically
# Let’s manually load the saved graph from results
import pandas as pd

results_file = 'runs/detect/train/results.csv'
df = pd.read_csv(results_file)
plt.figure(figsize=(7,4))
plt.plot(df['epoch'], df['train/box_loss'], label='Box Loss')
plt.plot(df['epoch'], df['train/cls_loss'], label='Class Loss')
plt.plot(df['epoch'], df['metrics/precision(B)'], label='Precision')
plt.xlabel('Epochs')
plt.ylabel('Loss / Precision')
plt.title('YOLOv8 Training Progress')
plt.legend()
plt.show()
